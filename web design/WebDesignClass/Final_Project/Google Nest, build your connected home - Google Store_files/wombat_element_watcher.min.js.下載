/**
 * @fileoverview This is bundle.min.js from gstore-element-watcher repo
 */
(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.WombatElementWatcher=f()}})(function(){var define,module,exports;return(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value" in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var _require=require('../utilities'),logElement=_require.logElement;module.exports=function(){function Element(_ref,disposalHandler,scrollY){var domNode=_ref.domNode,_ref$callback=_ref.callback,callback=_ref$callback===undefined?function(){return domNode.classList.add('is-visible')}:_ref$callback,_ref$enter=_ref.enter,enter=_ref$enter===undefined?callback:_ref$enter,exit=_ref.exit,persist=_ref.persist,_ref$once=_ref.once,once=_ref$once===undefined?!persist:_ref$once,_ref$enterOnce=_ref.enterOnce,enterOnce=_ref$enterOnce===undefined?once:_ref$enterOnce,_ref$exitOnce=_ref.exitOnce,exitOnce=_ref$exitOnce===undefined?once:_ref$exitOnce,_ref$offset=_ref.offset,offset=_ref$offset===undefined?function(){return Math.min(window.innerHeight,domNode.offsetHeight)*0.50}:_ref$offset,_ref$enterOffset=_ref.enterOffset,enterOffset=_ref$enterOffset===undefined?offset:_ref$enterOffset,_ref$exitOffset=_ref.exitOffset,exitOffset=_ref$exitOffset===undefined?window.innerHeight+domNode.offsetHeight:_ref$exitOffset,debug=_ref.debug;_classCallCheck(this,Element);this.domNode=domNode;this.disposalHandler=disposalHandler;this.enterHandler=enter;this.enterOffset=enterOffset;this.enterTriggerY=null;this.hasFiredEnter=!1;this.enterOnce=enterOnce;this.exitHandler=exit;this.exitOffset=exitOffset;this.exitTriggerY=null;this.hasFiredExit=!1;this.exitOnce=exitOnce;this.isActive=!1;this.isReversed=!1;this.domNodeTopPageOffset=null;this.scrollY=scrollY;this.isDebugging=debug;this.update()}
_createClass(Element,[{key:'update',value:function update(){this.setDomNodeTopPageOffset();this.setTriggers();this.handleDebug()}},{key:'setDomNodeTopPageOffset',value:function setDomNodeTopPageOffset(){var element=this.domNode;var domNodeTopPageOffset=0;while(element.offsetParent){domNodeTopPageOffset+=element.offsetTop-element.scrollTop+element.clientTop;element=element.offsetParent}
this.domNodeTopPageOffset=domNodeTopPageOffset}},{key:'setTriggers',value:function setTriggers(){var _this=this;['enter','exit'].forEach(function(type){var baseDomNodeOffset=_this.isReversed?_this.domNodeTopPageOffset+_this.domNode.offsetHeight+window.innerHeight:_this.domNodeTopPageOffset;var offset=_this[type+'Offset'].constructor===Function?_this[type+'Offset'](_this.domNode):_this[type+'Offset'];_this[type+'TriggerY']=_this.isReversed?baseDomNodeOffset-offset:baseDomNodeOffset+offset})}},{key:'handleState',value:function handleState(scrollY){this.scrollY=scrollY;var hasHandlers=this.enterHandler||this.exitHandler;var hasNeverEntered=!(this.hasFiredEnter&&this.enterOnce);var hasNeverExited=!(this.hasFiredExit&&this.exitOnce);var isScrolledPastEnterTrigger=this.isReversed?this.enterTriggerY>=this.scrollY:this.enterTriggerY<=this.scrollY;var isScrolledPastExitTrigger=this.isReversed?this.exitTriggerY>=this.scrollY:this.exitTriggerY<=this.scrollY;var hasBackedOut=!isScrolledPastEnterTrigger&&this.enterTriggerY!==this.scrollY;var shouldCallEnterHandler=hasNeverEntered&&isScrolledPastEnterTrigger&&!isScrolledPastExitTrigger&&!this.isActive;var shouldCallExitHandler=hasNeverExited&&(isScrolledPastExitTrigger||hasBackedOut)&&this.hasFiredEnter&&this.isActive;var isDisposable=!hasHandlers||!hasNeverEntered&&!(hasNeverExited&&this.exitHandler);if(shouldCallEnterHandler)this.handleEnter();if(shouldCallExitHandler)this.handleExit(hasBackedOut);if(isDisposable)this.disposalHandler()}},{key:'handleEnter',value:function handleEnter(){logElement(Object.assign({mode:'ENTER'},this));this.isActive=!0;this.hasFiredEnter=!0;if(this.enterHandler)this.enterHandler(this.domNode);this.updateTriggerReferenceElementContent('enter');this.domNode.dispatchEvent(new Event('enter'))}},{key:'handleExit',value:function handleExit(hasBackedOut){logElement(Object.assign({mode:'EXIT',hasBackedOut:hasBackedOut},this));this.isActive=!1;this.hasFiredExit=!0;if(this.exitHandler)this.exitHandler(this.domNode);this.updateTriggerReferenceElementContent('exit');this.domNode.dispatchEvent(new Event('exit'));if(!hasBackedOut)this.reverseEnterExit()}},{key:'updateTriggerReferenceElementContent',value:function updateTriggerReferenceElementContent(type){if(this.isDebugging){if(!/FIRED: \d*$/.test(this[type+'NameElement'].textContent)){this[type+'NameElement'].textContent+=' FIRED: 0'}
this[type+'NameElement'].textContent=this[type+'NameElement'].textContent.replace(/\d*$/,function(match){return+match+1});if(this[type+'Once'])this[type+'NameElement'].textContent+=' INACTIVE'}}},{key:'handleDebug',value:function handleDebug(){var _this2=this;if(!this.isDebugging)return;if(!this.enterTriggerReferenceElement){var name=this.domNode.id||this.domNode.classList.toString();['enter','exit'].forEach(function(type){var handler=_this2[type+'Handler'];_this2[type+'TriggerReferenceElement']=document.createElement('trigger');_this2[type+'NameElement']=document.createElement('span');_this2[type+'NameElement'].textContent=name+' '+type.toUpperCase()+(handler?'':' -NO HANDLER-');_this2[type+'NameElement'].style.cssText='background-color: white';_this2[type+'TriggerReferenceElement'].appendChild(_this2[type+'NameElement']);document.body.appendChild(_this2[type+'TriggerReferenceElement'])})}
var triggerColors={enter:this.isReversed?'royalblue':'green',exit:this.isReversed?'orange':'red'};['enter','exit'].forEach(function(type){var triggerY=_this2.isReversed?_this2[type+'TriggerY']:_this2[type+'TriggerY']-window.innerHeight;_this2[type+'TriggerReferenceElement'].style.cssText='position: absolute; display: block; z-index: 9999; height: 2px; left: 0; right: 0; top: '+triggerY+'px; background-color: '+triggerColors[type]+';'})}},{key:'reverseEnterExit',value:function reverseEnterExit(){this.isReversed=!this.isReversed;this.setTriggers();this.handleDebug()}}]);return Element}()},{"../utilities":4}],2:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value" in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var Element=require('./Element');var _require=require('../utilities'),throttle=_require.throttle,getDomNodes=_require.getDomNodes,params=_require.params;module.exports=function(){function Watcher(){var _this=this;_classCallCheck(this,Watcher);this.elements={};this.throttleScroll=throttle();this.throttleResize=throttle();this.windowInnerWidth=window.innerWidth;this.windowInnerHeight=window.innerHeight;this.scrollHeight=document.documentElement.scrollHeight;addEventListener('scroll',function(){return _this.handleScroll()});addEventListener('resize',function(){return _this.handleResize()});this.handleScrollHeightChange()}
_createClass(Watcher,[{key:'setScrollPosition',value:function setScrollPosition(){this.scrollY=window.pageYOffset+window.innerHeight}},{key:'handleScrollHeightChange',value:function handleScrollHeightChange(){var _this2=this;setInterval(function(){if(_this2.scrollHeight!==document.documentElement.scrollHeight){_this2.scrollHeight=document.documentElement.scrollHeight;_this2.setScrollPosition();Object.keys(_this2.elements).forEach(function(id){var element=_this2.elements[id];element.setDomNodeTopPageOffset();element.setTriggers();element.handleDebug()})}},500)}},{key:'handleScroll',value:function handleScroll(){var _this3=this;this.setScrollPosition();Object.keys(this.elements).forEach(function(id){return _this3.elements[id].handleState(_this3.scrollY)})}},{key:'handleResize',value:function handleResize(){var _this4=this;this.throttleResize(function(){var _window=window,innerWidth=_window.innerWidth,innerHeight=_window.innerHeight;_this4.setScrollPosition();if(innerWidth!==_this4.windowInnerWidth){_this4.windowInnerWidth=innerWidth;_this4.windowInnerHeight=innerHeight;return Object.keys(_this4.elements).forEach(function(id){return _this4.elements[id].update()})}
if(innerHeight!==_this4.windowInnerHeight){_this4.windowInnerHeight=innerHeight;Object.keys(_this4.elements).forEach(function(id){var element=_this4.elements[id];element.setDomNodeTopPageOffset();element.setTriggers();element.handleDebug()})}},function(){return _this4.handleResize()},100)}},{key:'add',value:function add(elementOptions){var _this5=this;var el=elementOptions.el,element=elementOptions.element,_elementOptions$eleme=elementOptions.elements,elements=_elementOptions$eleme===undefined?document.querySelectorAll('section'):_elementOptions$eleme,_elementOptions$debug=elementOptions.debug,debug=_elementOptions$debug===undefined?params.debug:_elementOptions$debug;var addElements=function addElements(){var domNodes=getDomNodes(el||element||elements);_this5.setScrollPosition();return domNodes.reduce(function(domNodes,domNode){if(!domNode)return domNodes;var id=Math.random()*Date.now();var disposalFn=function disposalFn(){return delete _this5.elements[id]};var watchedElement=new Element(Object.assign({domNode:domNode,debug:debug},elementOptions),disposalFn,_this5.scrollY);_this5.elements[id]=watchedElement;if(_this5.scrollY>watchedElement.enterTriggerY)watchedElement.reverseEnterExit();watchedElement.handleState(_this5.scrollY);return[].concat(_toConsumableArray(domNodes),[watchedElement])},[])};return new Promise(function(resolve){if(document.readyState==='complete')return resolve(addElements());document.addEventListener('readystatechange',function(){return resolve(addElements())})})}}]);return Watcher}()},{"../utilities":4,"./Element":1}],3:[function(require,module,exports){'use strict';var Watcher=require('./constructors/Watcher');var elementWatcher=new Watcher();module.exports=elementWatcher},{"./constructors/Watcher":2}],4:[function(require,module,exports){'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=!0;var _d=!1;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}
function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}
function getDomNodes(maybeNode){if(maybeNode instanceof NodeList||Array.isArray(maybeNode)){return[].concat(_toConsumableArray(maybeNode)).reduce(function(nodes,node){return[].concat(_toConsumableArray(nodes),_toConsumableArray(getDomNodes(node)))},[])}
if(maybeNode instanceof String){var domNode=document.querySelector(maybeNode);return[domNode]}
if(typeof jQuery==='function'&&maybeNode instanceof jQuery){return[maybeNode.get(0)]}
if(maybeNode instanceof HTMLElement){return[maybeNode]}}
function throttle(){var timer=void 0;var value=void 0;return function(throttledFn,callback,delay){if(!timer){setTimeout(function(){value=throttledFn();callback()},0);timer=setTimeout(function(){timer=undefined},delay||10)}
return value}}
function logElement(_ref){var mode=_ref.mode,domNode=_ref.domNode,_ref$domNode=_ref.domNode,id=_ref$domNode.id,className=_ref$domNode.className,enterTriggerY=_ref.enterTriggerY,enterHandler=_ref.enterHandler,exitTriggerY=_ref.exitTriggerY,exitHandler=_ref.exitHandler,_ref$trigger=_ref.trigger,trigger=_ref$trigger===undefined?enterTriggerY||exitTriggerY:_ref$trigger,scrollY=_ref.scrollY,hasBackedOut=_ref.hasBackedOut,isReversed=_ref.isReversed,isActive=_ref.isActive,isDebugging=_ref.isDebugging;if(isDebugging){console.info({domNode:domNode,mode:mode,id:id,className:className,trigger:trigger,scrollY:scrollY,isReversed:isReversed,hasBackedOut:hasBackedOut,isActive:isActive,enterHandler:enterHandler,exitHandler:exitHandler})}}
var getQueryParams=window.location.search.slice(1).split('&').reduce(function(queryParams,queryParam){if(!queryParam)return queryParams;var _queryParam$split=queryParam.split('='),_queryParam$split2=_slicedToArray(_queryParam$split,2),key=_queryParam$split2[0],value=_queryParam$split2[1];return Object.assign(queryParams,_defineProperty({},key,value))},{});module.exports={getDomNodes:getDomNodes,throttle:throttle,logElement:logElement,params:getQueryParams}},{}]},{},[3])(3)})
